<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta charset="utf-8" />
	<title>DrawAccidentSketch</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
	<script type="text/javascript" src="./draggabilly/dist/draggabilly.pkgd.min.js"></script>
	<script src="./bootstrap/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
	<link href="./stylesheets/main2.css" rel="stylesheet" />
	<link href="./stylesheets/sliderbar.css" rel="stylesheet" />
	<link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

	<div class="fab btn-group show-on-hover">
		<div id="inbox">
			<div class="fab btn-group show-on-hover dropup">
				<div data-toggle="tooltip" data-placement="left" title="Compose" style="">
					<button type="button" class="btn btn-danger btn-io dropdown-toggle" data-toggle="dropdown">
						<span class="fa-stack fa-2x">
								<i class="fa fa-plus fa-stack-1x fa-inverse fab-primary"></i>
								<i class="fa fa-pencil fa-stack-1x fa-inverse fab-secondary"></i>
							</span>
					</button>
				</div>
				<ul class="dropdown-menu dropdown-menu-right" role="menu">
					<li><a href="#" data-toggle="tooltip" data-placement="left" title="Car"><i class="fa fa-car"></i></a></li>
					<li><a href="#" data-toggle="tooltip" data-placement="left" title="Person"><i class="fa fa-male"></i></a></li>
					<li><a href="#" data-toggle="tooltip" data-placement="left" title="Road"><i class="fa fa-road"></i></a></li>
					<li><a href="#" data-toggle="tooltip" data-placement="left" title="Sign"><i class="fa fa-map-signs"></i></a></li>
					<div class="menu-bridge"></div>
				</ul>
			</div>
		</div>
	</div>

	<div class="DivSilderbar">
		<div class="silder-bar"></div>
	</div>

	<div id="DivSvg"></div>

</body>

</html>

<script type="text/javascript" src="./js/bgdraw.js"></script>
<script type="text/javascript" src="./js/d3.v3.js"></script>
<script type="text/javascript" src="./js/sliderbar.js"></script>
<script type="text/javascript">
	$(function(){
		
		var _oriw;
		var _orih;
		var _initCountX;
		var _initCountY;
		
		var _mainTimer;
		
		$('.fab').hover(function () {
			$(this).toggleClass('active');
		});

		_oriw = $('body')[0].clientWidth;
		_orih = $('body')[0].clientHeight;
		_initCountX = Math.round(_oriw/10);
		_initCountY = Math.round(_orih/10);

		var $RuleData = {
            'height': _orih,
            'width': _oriw,
            'dom': '#DivSvg',
            'Xcount': Math.round(_initCountX),
            'Ycount': Math.round(_initCountY),
        };
		
        create_draw.init($RuleData);
		
		$('#DivSvg').draggabilly();
		
		//建立 sliderbar 物件
		var SliderbarObj = new SilderModel();
		SliderbarObj.CreateCirclesSlider();
		
		//取得 sliderbar 的結果
		var _perX = 0;
		SliderbarObj.circlesSlider(function(LargerProportion){
			if(_perX == LargerProportion) return;
			_perX = LargerProportion;
			
			window.clearTimeout(_mainTimer);
			_mainTimer = window.setTimeout(function(){
				var w = _oriw * (_perX / 100);
				var h = _orih * (_perX / 100);
				$('body').css({ 'width':w, 'height':h });
				create_draw.changes(w, h, _initCountX, _initCountY);
				$('#DivSvg').css({
					'left': 0,
					'top': 0
				});
				
				$('#DivSvg').css({
					'left': (screen.width - w) / 2,
					'top': (screen.height - h) / 2
				});
			},1000);
		});
		
		$('#DivSvg').css({
			'left': (screen.width - _oriw) / 2,
			'top': (screen.height - _orih) / 2
		});
		
		var _tempMenuObj;
		$('.dropdown-menu > li').on({
			click: function () {
				if(_tempMenuObj !== this) {
					$('.dropdown-menu > li').find('a').removeClass('add-bridge');
					_tempMenuObj = this;
					
					$(this).find('a').toggleClass('add-bridge');
					
					$('.menu-content').remove();
					
					$(this).find('a').after('<div class="menu-content"></div>');
					$('.menu-content').css({
						'z-index': '99999998',
						'width': '100%', // 用 screen width 去大概算出一列可以放幾個
						'height': '10%',
						'background': 'silver',
						'position': 'absolute',
						'margin-top': '-40px', //.dropdown-menu > li > a 的 CSS
						'left': '200%',
						'display': 'block'
					});
				}
			}
		});
		
		$('.menu-content').on('mouseleave', function(){
			$('.menu-content').remove();
		});
		
		$('.menu-bridge').on('mouseleave', function(){
			$('.dropdown-menu > li').find('a').removeClass('add-bridge');
			$('.menu-content').remove();
		});
		
	});

</script>